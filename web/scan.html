
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="apple-touch-icon" type="image/png" href="https://static.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png" />
<meta name="apple-mobile-web-app-title" content="CodePen">
<link rel="shortcut icon" type="image/x-icon" href="https://static.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico" />
<link rel="mask-icon" type="" href="https://static.codepen.io/assets/favicon/logo-pin-8f3771b1072e3c38bd662872f6b673a722f4b3ca2421637d5596661b4e2132cc.svg" color="#111" />
<title>CodePen - svg prime js generated chromeplay exponent xfer</title>
<style>
html, body {
  height: 100%;
  width: 100%;
}
</style>
</head>
<body translate="no">
  <svg id=mysvg width="100%" height="100%" shape-rendering="optimizeSpeed">
    <defs>
      <filter id="myfilter" color-interpolation-filters ="sRGB">
      </filter>
    </defs>
  </svg>
  <iframe id="imageFrame"  style="position: absolute; top: 0; left: 0; width: 768px; height: 512px; border: 0; filter:url(#myfilter)"></iframe>
  <script id="rendered-js">
  const DISCRETE_LAYERS = 10;
  const VALUES_PER_LAYER = 8;

  // Knuth shuffle
  function shuffle(arrayToShuffle) {
      arrayToShuffle[0] = 0;
      arrayToShuffle[1] = 0.37109375;
      arrayToShuffle[2] = 0.62109375;
      arrayToShuffle[3] = 0.62109375;
      arrayToShuffle[4] = 0.87109375;
      arrayToShuffle[5] = 0.87109375;
      arrayToShuffle[6] = 0.1953125;
      arrayToShuffle[7] = 0.1953125;
    
    return arrayToShuffle;
  }


  function getQueryStringParam(param) {
        var url = window.location.toString();
        url.match(/\?(.+)$/);
        var params = RegExp.$1;
        params = params.split("&");
        var queryStringList = {};
        for (var i = 0; i < params.length; i++) {
          var tmp = params[i].split("=");
          queryStringList[tmp[0]] = unescape(tmp[1]);
        }
        return queryStringList[param];
      }

  window.onload = function() {

    var imageSource = getQueryStringParam("image");
    var imageUrl = "/applayfiltersWithparams.html?filter=hue-rotate&image=" + imageSource
    // var imageUrl = "/backgrounds/" + imageSource + "py.bmp"
    document.getElementById("imageFrame").src = imageUrl;
    var svgns="http://www.w3.org/2000/svg";

    // Create an array with the unshuffled values
    var unshuffledArray = new Array(VALUES_PER_LAYER);
    unshuffledArray[0] = 0;
    unshuffledArray[1] = 0.37109375;
    unshuffledArray[2] = 0.62109375;
    unshuffledArray[3] = 0.62109375;
    unshuffledArray[4] = 0.87109375;
    unshuffledArray[5] = 0.87109375;
    unshuffledArray[6] = 0.1953125;
    unshuffledArray[7] = 0.1953125;


    // Shuffle the array
    var shuffledArray = unshuffledArray;
    var myfilter = document.getElementById("myfilter");
    // create a component transfer from the shuffled array
    for (var layer = 0; layer < DISCRETE_LAYERS; layer++) {
      var mycT = document.createElementNS(svgns,"feComponentTransfer");
      mycT.setAttribute("color-interpolation-filters","sRGB")
      var funcg = document.createElementNS(svgns,"feFuncG");
      funcg.setAttribute("type","discrete");
      var funcb = document.createElementNS(svgns,"feFuncB");
      funcb.setAttribute("type","discrete");
      var funcr = document.createElementNS(svgns,"feFuncR");
      funcr.setAttribute("type","discrete");
      mycT.setAttribute("result",""+(layer+1));
      if(layer > 0){
          mycT.setAttribute("in",""+layer);
      }
      //var funcb = document.getElementById("funcb_layer" + layer);
      //var funcr = document.getElementById("funcr_layer" + layer);

      console.log(shuffledArray)
      for (var entry = 0; entry < shuffledArray.length; entry++) {
        var newNumber = mysvg.createSVGNumber();
        newNumber.value = shuffledArray[entry] ;
        funcg.tableValues.baseVal.appendItem(newNumber);
        funcb.tableValues.baseVal.appendItem(newNumber);
        funcr.tableValues.baseVal.appendItem(newNumber);
      }

      mycT.appendChild(funcg);
      mycT.appendChild(funcb);
      mycT.appendChild(funcr);
      myfilter.appendChild(mycT);


    }
  }

  /* 
                                                                                            tableValues="0"/>
          </feComponentTransfer>
          <feComponentTransfer id="transfer" result="totransfer">                  <feFuncG  id="funcg_layer4" type="discrete"
                                                                                            tableValues="0"/>
          </feComponentTransfer>
          <feComponentTransfer id="transfer" result="totransfer">                  <feFuncG  id="funcg_layer5" type="discrete"
                                                                                            tableValues="0"/>
          </feComponentTransfer>
          <feComponentTransfer id="transfer" result="totransfer">                  <feFuncG  id="funcg_layer6" type="discrete"
                                                                                            tableValues="0"/>
          </feComponentTransfer>
          <feComponentTransfer id="transfer" result="totransfer">                  <feFuncG  id="funcg_layer7" type="discrete"
                                                                                            tableValues="0"/>
          </feComponentTransfer>
          <feComponentTransfer id="transfer" result="totransfer">                  <feFuncG  id="funcg_layer8" type="discrete"
                                                                                            tableValues="0"/>
          </feComponentTransfer>


  // Create an array with the unshuffled values
    var unshuffledArray = new Array(VALUES_PER_LAYER);
    unshuffledArray[0] = 0;
    unshuffledArray[1] = 0.37109375;
    unshuffledArray[2] = 0.62109375;
    unshuffledArray[3] = 0.62109375;
    unshuffledArray[4] = 0.87109375;
    unshuffledArray[5] = 0.87109375;
    unshuffledArray[6] = 0.1953125;
    unshuffledArray[7] = 0.1953125;
    
      for (i = 0; i < unshuffledArray.length; i++) {
      unshuffledArray[i] = (i + 65) % 255;
      if (unshuffledArray[i] < 3){
          unshuffledArray[i] = 4;
      }
      unshuffledArray[0] = 0;
      unshuffledArray[i] =  unshuffledArray[i] / 255;
    }
          */
  </script>
</body>
</html>